<!DOCTYPE html>













<html lang="ko-kr">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  
  <title>Pytorch DPì™€ DDP - Solang Kim</title>

  
  
  <meta name="description" content="torch.nn.DataParallel(DP)ê³¼ torch.nn.parallel.DistributedDataParallel(DDP) ì˜ ì°¨ì´ì ì— ëŒ€í•´ ì•Œì•„ë³´ê³ , DPì™€ DDP ì¤‘ ì™œ DDPë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ì§€ì— ëŒ€í•´ ê°„ëµíˆ ì„¤ëª…í•©ë‹ˆë‹¤." />
  <meta name="author" content="" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="https://solangii.github.io/app.min.css" />

  
  <link rel="preload stylesheet" as="style" href="https://solangii.github.io/an-old-hope.min.css" />
  <script
    defer
    src="https://solangii.github.io/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
  <link rel="preload" as="image" href="https://solangii.github.io/theme.png" />
  <link rel="preload" as="image" href="https://solangii.github.io/logo.png" />


  
  <link rel="preload" as="image" href="https://solangii.github.io/github.svg" />
  
  <link rel="preload" as="image" href="https://solangii.github.io/instagram.svg" />
  

  
  <link rel="icon" href="https://solangii.github.io/favicon.ico" />
  <link rel="apple-touch-icon" href="https://solangii.github.io/apple-touch-icon.jpg" />

  
  <meta name="generator" content="Hugo 0.102.1" />

  
  

  
  
  
  
  
  
  
  
  
  <meta property="og:title" content="Pytorch DPì™€ DDP" />
<meta property="og:description" content="torch.nn.DataParallel(DP)ê³¼ torch.nn.parallel.DistributedDataParallel(DDP) ì˜ ì°¨ì´ì ì— ëŒ€í•´ ì•Œì•„ë³´ê³ , DPì™€ DDP ì¤‘ ì™œ DDPë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ì§€ì— ëŒ€í•´ ê°„ëµíˆ ì„¤ëª…í•©ë‹ˆë‹¤." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://solangii.github.io/posts/22-07-05-ddp/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-05T00:12:57+09:00" />
<meta property="article:modified_time" content="2022-07-05T00:12:57+09:00" />


  
  <meta itemprop="name" content="Pytorch DPì™€ DDP">
<meta itemprop="description" content="torch.nn.DataParallel(DP)ê³¼ torch.nn.parallel.DistributedDataParallel(DDP) ì˜ ì°¨ì´ì ì— ëŒ€í•´ ì•Œì•„ë³´ê³ , DPì™€ DDP ì¤‘ ì™œ DDPë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ì§€ì— ëŒ€í•´ ê°„ëµíˆ ì„¤ëª…í•©ë‹ˆë‹¤."><meta itemprop="datePublished" content="2022-07-05T00:12:57+09:00" />
<meta itemprop="dateModified" content="2022-07-05T00:12:57+09:00" />
<meta itemprop="wordCount" content="211">
<meta itemprop="keywords" content="pytorch,ddp," />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Pytorch DPì™€ DDP"/>
<meta name="twitter:description" content="torch.nn.DataParallel(DP)ê³¼ torch.nn.parallel.DistributedDataParallel(DDP) ì˜ ì°¨ì´ì ì— ëŒ€í•´ ì•Œì•„ë³´ê³ , DPì™€ DDP ì¤‘ ì™œ DDPë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ì§€ì— ëŒ€í•´ ê°„ëµíˆ ì„¤ëª…í•©ë‹ˆë‹¤."/>

  
  
</head>


  <body class="not-ready" data-menu="true">
    <header class="header">
  
  <p class="logo">
    <a class="site-name" href="https://solangii.github.io/">Solang Kim</a>
  </p>
  

  <script>
    
    
    
    

    
      
      
    

    
    

    
    
  </script>


  
  
  <nav class="menu">
    
    <a class="" href="/about/">ğŸ‘€ About</a>
    
    <a class="" href="/posts/">ğŸ“š Posts</a>
    
  </nav>
  

  
  <nav class="social">
    
    <a
      class="github"
      style="--url: url(./github.svg)"
      href="https://github.com/solangii"
      target="_blank"
    ></a>
    
    <a
      class="instagram"
      style="--url: url(./instagram.svg)"
      href="https://instagram.com/s_rang__"
      target="_blank"
    ></a>
    
  </nav>
  
</header>


    <main class="main">

<article class="post-single">

    <header class="post-title">
    <p>
      <h3>snippet</h3>
      
      <time>2022. 7. 5.</time>
      
      
    </p>
    <h1>Pytorch DPì™€ DDP</h1>
  </header>

  

  <section class="post-content"><p><code>torch.nn.DataParallel</code>(DP)ê³¼ <code>torch.nn.parallel.DistributedDataParallel</code>(DDP) ì˜ ì°¨ì´ì ì— ëŒ€í•´ ì•Œì•„ë³´ê³ , DPì™€ DDP ì¤‘ ì™œ DDPë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ì§€ì— ëŒ€í•´ <em>ê°„ëµíˆ</em> ì„¤ëª…í•©ë‹ˆë‹¤.</p>
<hr>
<p><a href="https://pytorch.org/docs/stable/generated/torch.nn.DataParallel.html">DataParallel(DP)</a>ê³¼ <a href="https://pytorch.org/docs/stable/notes/ddp.html#ddp">DistributedDataParallel(DDP)</a>ì€ ëª¨ë‘ pytorchì—ì„œ multi-gpu í™˜ê²½ì—ì„œì˜ ì‹¤í—˜ì„ ìœ„í•œ í•¨ìˆ˜ì…ë‹ˆë‹¤.</p>
<p>ë‘ í•¨ìˆ˜ ëª¨ë‘ modelì„ ì§€ì •ëœ ì—¬ëŸ¬ gpuì— ë³µì‚¬ë¥¼ í•˜ê³  dataë¥¼(batchë‹¨ìœ„ë¡œ) gpuë³„ë¡œ í• ë‹¹í•´ì£¼ë©° ë™ì‘ì„ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ time performanceë¥¼ ì‚´í´ë³´ë©´ DDPê°€ í›¨ì”¬ ì¢‹ìŠµë‹ˆë‹¤. <strong>Key DifferenceëŠ” multi-threadingì„ ì‚¬ìš©í•˜ëƒ / multi-processingì„ ì‚¬ìš©í•˜ëƒì— ë”°ë¼ ì°¨ì´ê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.</strong></p>
<p>muti-thread, multi-processì— ë”°ë¥¸ ì°¨ì´ë¥¼ ì„¤ëª…ë“œë¦¬ê¸° ìœ„í•´ threadì™€ processì˜ ì°¨ì´ë¥¼ ê°„ëµíˆ ì„¤ëª…ë“œë¦½ë‹ˆë‹¤. threadëŠ” processë‚´ì—ì„œ memory-sharedê°€ ì´ë¤„ì§‘ë‹ˆë‹¤. ë°˜ë©´, processëŠ” processê°„ì— memoryê°€ ê³µìœ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ memoryê°€ ê³µìœ ë˜ëŠ” multi-threadí™˜ê²½ì—ì„œëŠ” context swithchê°€ ë°œìƒí•  ë•Œ, memory leakì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ìœ ë…í•´ì•¼í•©ë‹ˆë‹¤.</p>
<p>python interpreterì—ì„œëŠ” multi-thread í™˜ê²½ì—ì„œì˜ memory leakì„ ëŒ€ë¹„í•˜ì—¬ GIL(global interpreter lock)ì´ë¼ëŠ” mutexë¥¼ ê±¸ì–´ì¤ë‹ˆë‹¤. ì´ë¡œì¸í•´ ë™ì‹œê°„ëŒ€ì— thread í•˜ë‚˜ë§Œ ì ìœ ë¥¼ í•˜ê²Œ ë˜ëŠ”ë°ìš” (ë‹¤ë¥¸ threadëŠ” ëŒ€ê¸°ì¤‘) ì‚¬ì‹¤ìƒ GILë¡œ ì¸í•´ &ldquo;multi&rdquo;-threadì„ì—ë„ ë¶ˆêµ¬í•˜ê³  ë³‘ë ¬ë¡œ ë™ì‘í•˜ì§€ ëª»í•˜ëŠ” í˜„ìƒì´ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.</p>
<p><strong>DPëŠ” multi-threadingì„ ì´ìš©í•©ë‹ˆë‹¤</strong>. ë”°ë¼ì„œ ìœ„ì—ì„œ ì–¸ê¸‰í•œ ìƒí™©ì´ ë°œìƒí•©ë‹ˆë‹¤. batchë‹¨ìœ„ë¡œ gradientë¥¼ ê³„ì‚°í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ê°œì˜ threadê°€ multi-gpuì— ëŒ€ê¸°í•´ ìˆëŠ” ìƒí™©ì¸ë°, <strong>GILë¡œ ì¸í•´ í•˜ë‚˜ì˜ threadë§Œ ë™ì‹œê°„ëŒ€ì— ë™ì‘</strong>í•˜ê²Œ ë˜ë‹ˆ ì‚¬ì‹¤ìƒ parallelí•˜ê²Œ ë™ì‘í•˜ì§€ ëª»í•˜ê³  ë™ ì‹œê°„ëŒ€ì— í•˜ë‚˜ì˜ threadë§Œ ì ìœ ë¥¼ í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ë¡œ ì¸í•´, performance overheadê°€ ì¼ì–´ë‚©ë‹ˆë‹¤.</p>
<p><strong>ë°˜ë©´, DDPëŠ” multi-prossingì„ ì´ìš©í•©ë‹ˆë‹¤.</strong> batchë‹¨ìœ„ë¡œ gradientë¥¼ ê³„ì‚°í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ê°œì˜ processê°€ multi-gpuì— ëŒ€ê¸°í•´ ìˆëŠ” ìƒí™©ì¸ë° processê°„ì— memory-sharedê°€ ì—†ìœ¼ë‹ˆ GILê°™ì€ mutexê°€ í•„ìš” ì—†ìŠµë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ì—¬ëŸ¬ Processê°€ ë™ì‹œê°„ëŒ€ì— parallelí•˜ê²Œ ë™ì‘í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ DPë³´ë‹¤ ë¹ ë¥¸ performanceë¥¼ ë³´ì…ë‹ˆë‹¤.</p>
<p><strong>ê²°ë¡ , DDP ì“°ì!</strong></p>
<hr>
<p><strong>Reference</strong></p>
<ul>
<li><a href="https://pytorch.org/docs/stable/generated/torch.nn.DataParallel.html">https://pytorch.org/docs/stable/generated/torch.nn.DataParallel.html</a></li>
<li><a href="https://pytorch.org/docs/stable/notes/cuda.html#cuda-nn-ddp-instead">https://pytorch.org/docs/stable/notes/cuda.html#cuda-nn-ddp-instead</a></li>
<li><a href="https://pytorch.org/docs/stable/notes/ddp.html#ddp">https://pytorch.org/docs/stable/notes/ddp.html#ddp</a></li>
<li><a href="https://dgkim5360.tistory.com/entry/understanding-the-global-interpreter-lock-of-cpython">https://dgkim5360.tistory.com/entry/understanding-the-global-interpreter-lock-of-cpython</a></li>
</ul>
</section>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async>
MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
           extensions: ["AMSmath.js", "AMSsymbols.js"] }
    }
    });
    MathJax.Hub.Queue(function() {
      
      
      
      var all = MathJax.Hub.getAllJax(), i;
      for(i = 0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  
    MathJax.Hub.Config({
    
    TeX: { equationNumbers: { autoNumber: "AMS" } }
    });
</script>


 

  
    
  
  <footer class="post-tags">
     
    <a href="https://solangii.github.io/tags/pytorch">#pytorch</a>
     
    <a href="https://solangii.github.io/tags/ddp">#ddp</a>
    
  </footer>
  

  
    
  
  <nav class="post-nav">
    
    <a class="prev" href="https://solangii.github.io/posts/22-08-31-kubenetes-cil/"><span>â†</span><span>ğŸ¯ Kubernetes Snippets</span></a>
     
    <a class="next" href="https://solangii.github.io/posts/22-04-02-pytorch-snippets/"><span>ğŸ“Œ PyTorch Snippets</span><span>â†’</span></a>
    
  </nav>
  

  
    
  <script src="https://utteranc.es/client.js"
        repo="solangii/solangii.github.io"
        issue-term="title"
        label="âœ¨ğŸ’¬âœ¨"
        theme="github-light"
        crossorigin="anonymous"
        async>
  </script>
  

</article>


</main>

    <footer class="footer">
  <p>&copy; 2022 <a href="https://solangii.github.io/">Solang Kim</a></p>
</footer>

  </body>
</html>
